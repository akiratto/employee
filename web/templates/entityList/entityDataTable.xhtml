<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:jsf="http://xmlns.jcp.org/jsf"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <h:head>
        <title>entityDataTable</title>
    </h:head>
    <h:body>
        <ui:composition>
            <!-- 変数準備 -->
            <c:set var="jsfUIIdField" 
                   value="#{entityReflectionBean.getJsfUIIdField(entityListBean.searchCondition)}" />
            <c:set var="jsfUIInternalIdField"
                    value="#{entityReflectionBean.getJsfUIInternalIdField(entityListBean.searchCondition)}" />
            
            <!-- エンティティの一覧表の表示部分 -->
            <c:if test="#{     (not empty jsfUIIdField) 
                           and (not empty jsfUIInternalIdField)
                           and (jsfUIIdField.hasJsfUIListColumn())
                           }">
                <!-- エンティティの@JsfUIIdFieldを指定したフィールドが存在し、
                     かつ、そのフィールドに@JsfUIListColumnが指定されていること  -->
                
                <!-- データが存在しない場合はメッセージを表示する -->
                <h:outputText value="#{entityJpName}は見つかりません。"
                               rendered="#{empty entityListBean.entityDataList}"
                               style="display: block;margin-top:16px;"/>

                <!-- データが1件以上存在する場合、一覧表の上部のナビゲートを表示 -->
                <div style="position: relative;width:1000px;height:30px;"
                     jsf:rendered="#{not empty entityListBean.entityDataList}">

                    <!-- ナビゲート部分  表示例) 前へ 1 2 3 4 5 次へ -->
                    <div id="topPageNavigator">
                        <h:commandLink action="#{entityListBean.pageNavigator.prevPage()}"
                                        value="前へ"
                                        rendered="#{entityListBean.pageNavigator.prevPageEnabled()}"
                                        style="margin-right:0.6em;"/>
                        <ui:repeat value="#{entityListBean.pageNavigator.pageLinks}" var="p">
                            <!-- ページ番号が現在のページならリンク有で表示 -->
                            <h:commandLink action="#{p.moveToPage()}" 
                                            value="#{p.pageNo}" 
                                            rendered="#{not p.isCurrentPage()}"
                                            style="margin-right:0.6em;" />

                            <!-- ページ番号が現在のページ以外ならリンク無で表示 -->
                            <h:outputText value="#{p.pageNo}"
                                           rendered="#{p.isCurrentPage()}"
                                           style="font-weight: bold;margin-right:0.6em;" />
                        </ui:repeat>
                        <h:commandLink action="#{entityListBean.pageNavigator.nextPage()}"
                                        value="次へ"
                                        rendered="#{entityListBean.pageNavigator.nextPageEnabled()}" />
                    </div>
                    <!-- 一覧表の表示範囲、最大件数 を表示 -->
                    <div id="countInfo">
                        <h:outputText value="[#{entityJpName}を #{entityListBean.entityAllCount}件中#{entityListBean.pageNavigator.beginRowIndex}～#{entityListBean.pageNavigator.endRowIndex}件 表示]" />
                    </div>
                </div>

                <!-- データが1件以上存在する場合、一覧表を表示 -->
                <h:dataTable id="employee_list"
                              styleClass="employee_list" 
                              value="#{entityListBean.entityDataList}" 
                              var="emp"  
                              rendered="#{not empty entityListBean.entityDataList}">



                    <!-- 削除ボタン -->
                    <h:column>
                        <f:facet name="header">
                            <h:outputText value="ボタン" />
                        </f:facet>
                        <h:commandButton id="delete_button"
                                          value="削除" 
                                          onclick="return confirm('社員コード:'+ F2(this,'employee_code') + 'を削除してもよろしいですか？')"
                                          action="#{entityListBean.delete( jsfUIInternalIdField.value )}" />
                        <h:inputHidden id="#{jsfUIIdField.snakeCaseName}" value="#{entityReflectionBean.getJsfUIIdField(emp).value}" />
                    </h:column>

                    <!-- エンティティのIDカラム -->
                    <h:column>
                        <f:facet name="header">
                            <h:outputText value="#{jsfUIIdField.jsfUIListColumn.labelTitle()}" /> <!-- entityReflectionBean.getJsfUIIdField(emp).jsfUIListColumn.labelTitle() はempがnullになるのでエラーとなる。facetは評価のタイミングが違う？ -->
                        </f:facet>
                        <h:commandLink action="#{entityListBean.gotoDetail(entityReflectionBean.getJsfUIInternalIdField(emp).value, 'Read')}">
                            <h:outputText value="#{entityReflectionBean.getJsfUIIdField(emp).value}" />
                        </h:commandLink>
                    </h:column>

                    <c:forEach var="fd" items="#{entityReflectionBean.getEntityFieldsWithJsfUIListColumn(entityListBean.searchCondition)}">
                        <c:if test="#{not fd.hasJsfUIId() and not fd.hasJsfUIInternalId()}">
                            <c:if test="#{fd.hasJsfUIListColumn()}">
                                <c:if test="#{fd.jsfUIListColumn.columnType().eqHtmlInputText()}">
                                    <h:column>
                                        <f:facet name="header">
                                            <h:outputText value="#{fd.jsfUIListColumn.labelTitle()}" />
                                        </f:facet>
                                        #{entityReflectionBean.findEntityField(emp, fd.name).value}
                                    </h:column>
                                </c:if>
                            </c:if>
                        </c:if>
                    </c:forEach>
                </h:dataTable>
                
            </c:if>
            
            <!-- データが1件以上存在する場合、一覧表の下部のナビゲートを表示 -->
            <p style="width:1000px; text-align:center;">
                
                <h:commandLink action="#{entityListBean.pageNavigator.prevPage()}" 
                                value="前へ" 
                                rendered="#{entityListBean.pageNavigator.prevPageEnabled()}" 
                                style="margin-right:0.6em;"/>
                <ui:repeat value="#{entityListBean.pageNavigator.pageLinks}" var="p">
                    <h:commandLink action="#{p.moveToPage()}"
                                    value="#{p.pageNo}" 
                                    rendered="#{not p.isCurrentPage()}" 
                                    style="margin-right:0.6em;" />
                    <h:outputText value="#{p.pageNo}"
                                   rendered="#{p.isCurrentPage()}" 
                                   style="font-weight: bold;margin-right:0.6em;" />
                </ui:repeat>
                <h:commandLink action="#{entityListBean.pageNavigator.nextPage()}" 
                                value="次へ" 
                                rendered="#{entityListBean.pageNavigator.nextPageEnabled()}" />
            </p>
        </ui:composition>
    </h:body>
</html>

